#Install packages
require(SASxport)
library(dplyr)
library(readr)

#Read RXQ file
RXQ_RX_E <- read.xport("DATA/RXQ_RX Prescription Medications/RXQ_RX_E.XPT")
RXQ_RX_F <- read.xport("DATA/RXQ_RX Prescription Medications/RXQ_RX_F.XPT")
RXQ_RX_G <- read.xport("DATA/RXQ_RX Prescription Medications/RXQ_RX_G.XPT")
RXQ_RX_H <- read.xport("DATA/RXQ_RX Prescription Medications/RXQ_RX_H.XPT")
#RXQ_RX_I <- read.xport("DATA/RXQ_RX Prescription Medications/RXQ_RX_I.XPT")

myvars <- c("SEQN","RXDDRUG")
RXQ_RX_E <- RXQ_RX_E[myvars]
RXQ_RX_F <- RXQ_RX_F[myvars]
RXQ_RX_G <- RXQ_RX_G[myvars]
RXQ_RX_H <- RXQ_RX_H[myvars]
#RXQ_RX_I <- RXQ_RX_I[myvars]

#RXQ_RX<-rbind(RXQ_RX_E,RXQ_RX_F,RXQ_RX_G,RXQ_RX_H,RXQ_RX_I)
RXQ_RX<-rbind(RXQ_RX_E,RXQ_RX_F,RXQ_RX_G,RXQ_RX_H)
remove(RXQ_RX_E)
remove(RXQ_RX_F)
remove(RXQ_RX_G)
remove(RXQ_RX_H)
#remove(RXQ_RX_I)

ASPIRIN_USER<-dplyr::filter(RXQ_RX, grepl('*ASPIRIN*', RXQ_RX$RXDDRUG))
ASPIRIN_USER$ASPIRIN<-1
ASPIRIN_USER <- ASPIRIN_USER[c("SEQN","ASPIRIN")]
ASPIRIN_USER <- ASPIRIN_USER %>% distinct()

STATIN_USER<-dplyr::filter(RXQ_RX, grepl('*STATIN*', RXQ_RX$RXDDRUG))
STATIN_USER$STATIN<-1
STATIN_USER <- STATIN_USER[c("SEQN","STATIN")]
STATIN_USER <- STATIN_USER %>% distinct()

OPIUM_USER<-dplyr::filter(RXQ_RX, grepl('*OPIUM*', RXQ_RX$RXDDRUG))
OPIUM_USER$OPIUM<-1
OPIUM_USER <- OPIUM_USER[c("SEQN","OPIUM")]
OPIUM_USER <- OPIUM_USER %>% distinct()

ATORVASTATIN_USER<-dplyr::filter(RXQ_RX, grepl('*ATORVASTATIN*', RXQ_RX$RXDDRUG))
ATORVASTATIN_USER$ATORVASTATIN<-1
ATORVASTATIN_USER <- ATORVASTATIN_USER[c("SEQN","ATORVASTATIN")]
ATORVASTATIN_USER <- ATORVASTATIN_USER %>% distinct()

VALSARTAN_USER<-dplyr::filter(RXQ_RX, grepl('*VALSARTAN*', RXQ_RX$RXDDRUG))
VALSARTAN_USER$VALSARTAN<-1
VALSARTAN_USER <- VALSARTAN_USER[c("SEQN","VALSARTAN")]
VALSARTAN_USER <- VALSARTAN_USER %>% distinct()

IBUPROFEN_USER<-dplyr::filter(RXQ_RX, grepl('*IBUPROFEN*', RXQ_RX$RXDDRUG))
IBUPROFEN_USER$IBUPROFEN<-1
IBUPROFEN_USER <- IBUPROFEN_USER[c("SEQN","IBUPROFEN")]
IBUPROFEN_USER <- IBUPROFEN_USER %>% distinct()

PRESCRIPTION<-merge(ASPIRIN_USER,ATORVASTATIN_USER,all=TRUE)
PRESCRIPTION<-merge(PRESCRIPTION,IBUPROFEN_USER,all=TRUE)
PRESCRIPTION<-merge(PRESCRIPTION,OPIUM_USER,all=TRUE)
PRESCRIPTION<-merge(PRESCRIPTION,STATIN_USER,all=TRUE)
PRESCRIPTION<-merge(PRESCRIPTION,VALSARTAN_USER,all=TRUE)

remove(ASPIRIN_USER)
remove(ATORVASTATIN_USER)
remove(IBUPROFEN_USER)
remove(OPIUM_USER)
remove(RXQ_RX)
remove(STATIN_USER)
remove(VALSARTAN_USER)

